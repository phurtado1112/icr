(function(f){var b={canvas:true};var c,d,a;var e=Object.prototype.hasOwnProperty;function g(j,i){var h=i.Canvas;if(c==null){d=h.prototype.getTextInfo,a=h.prototype.addText,c=h.prototype.render}h.prototype.render=function(){if(!j.getOptions().canvas){return c.call(this)}var m=this.context,k=this._textCache;m.save();for(var w in k){if(e.call(k,w)){var l=k[w];for(var r in l){if(e.call(l,r)){var o=l[r],p=true;for(var z in o){if(e.call(o,z)){var n=o[z];if(!n.active){delete o[z];continue}var v=n.x,t=n.y,B=n.lines,s=n.halign;if(p){m.fillStyle=n.font.color;m.font=n.font.definition;p=false}m.textBaseline="top";for(var q=0;q<B.length;++q){var A=B[q],u=v;if(s=="center"){u-=A.width/2}else{if(s=="right"){u-=A.width}}if(!!(window.opera&&window.opera.version().split(".")[0]<12)){u=Math.floor(u);t=Math.ceil(t-2)}m.fillText(A.text,u,t);t+=A.height}}}}}}}m.restore()};h.prototype.getTextInfo=function(t,y,o,p){if(!j.getOptions().canvas){return d.call(this,t,y,o,p)}var u,k,m,n;y=""+y;if(typeof o==="object"){u=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family}else{u=o}k=this._textCache[t];if(k==null){k=this._textCache[t]={}}m=k[u];if(m==null){m=k[u]={}}n=m[y];if(n==null){var l=this.context;if(typeof o!=="object"){var r=f("<div></div>").html(y).addClass(typeof o==="string"?o:null).css({position:"absolute",top:-9999}).appendTo(this.getTextLayer(t));o={style:r.css("font-style"),variant:r.css("font-variant"),weight:r.css("font-weight"),size:parseInt(r.css("font-size"),10),family:r.css("font-family"),color:r.css("color")};r.remove()}u=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px "+o.family;n=m[y]={x:null,y:null,width:0,height:0,active:false,lines:[],font:{definition:u,color:o.color}};l.save();l.font=u;var z=(y+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(var q=0;q<z.length;++q){var w=z[q],v=l.measureText(w),s,x;s=v.width;x=v.height||o.size;x+=Math.round(o.size*0.15);n.width=Math.max(s,n.width);n.height+=x;n.lines.push({text:w,width:s,height:x})}l.restore()}return n};h.prototype.addText=function(o,r,p,s,l,m,n,q){if(!j.getOptions().canvas){return a.call(this,o,r,p,s,l,m,n,q)}var k=this.getTextInfo(o,s,l,m);k.x=r;k.y=p;k.active=true;k.halign=n;if(q=="middle"){k.y=p-k.height/2}else{if(q=="bottom"){k.y=p-k.height}}}}f.plot.plugins.push({init:g,options:b,name:"canvas",version:"1.0"})})(jQuery);